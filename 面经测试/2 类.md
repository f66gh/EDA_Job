æ²¡é—®é¢˜ï¼Œè¿™ä¸€æ­¥åšå¾—å¾ˆå¯¹ ğŸ‘
 æˆ‘å¸®ä½ æŠŠ **æ¨¡å— 2ï¼šç±»ä¸å¯¹è±¡è¯­æ³•åŸºç¡€** å±•å¼€æˆä¸€ä»½â€œç»†é¢—ç²’åº¦çŸ¥è¯†ç‚¹æ¸…å•â€ï¼Œä½ å¯ä»¥ä¸€æ¡æ¡å¯¹ç…§è‡ªå·±ä¼šä¸ä¼šã€‚

æˆ‘ä¼šæŒ‰ä½ å¤§çº²é‡Œçš„ç»“æ„æ¥æ‹†ï¼š

- 2.1 `struct / class` & è®¿é—®æ§åˆ¶
- 2.2 `this` æŒ‡é’ˆ & `const`
- 2.3 `static` / `mutable` æˆå‘˜
- 2.4 æ„é€  / ææ„ / `explicit`

ä½ å¯ä»¥å…ˆç”¨å®ƒè‡ªæµ‹ï¼š**ä¼šè®²+èƒ½å†™ä»£ç ** å°±ç®—æŒæ¡ã€‚

------

## 2.1 struct / class & è®¿é—®æ§åˆ¶

### 2.1.1 `struct` vs `class` çš„è¯­æ³•åŒºåˆ«

1. **é»˜è®¤è®¿é—®æƒé™**ï¼ˆè¯­æ³•å”¯ä¸€å·®åˆ«ï¼‰
   - `struct`ï¼šé»˜è®¤ **public**
   - `class`ï¼šé»˜è®¤ **private**
2. æˆå‘˜å‡½æ•°ã€ç»§æ‰¿ç­‰è¯­æ³•æ–¹é¢ï¼Œ**å®Œå…¨ä¸€æ ·**ã€‚
3. å…¸å‹ä½¿ç”¨ä¹ æƒ¯ï¼ˆå·¥ç¨‹é£æ ¼ï¼Œä¸æ˜¯è¯­æ³•å¼ºåˆ¶ï¼‰ï¼š
   - `struct`ï¼š
     - ç”¨äº **ç®€å•æ•°æ®èšåˆ**ï¼ˆPODï¼Œå‡ ä¹æ²¡ä¸å˜é‡çº¦æŸï¼‰
     - æ›´å¤šå½“æˆâ€œC é£æ ¼çš„ struct + ä¸€ç‚¹ç‚¹æ–¹æ³•â€
   - `class`ï¼š
     - ç”¨äºæœ‰ **å°è£…/ä¸å˜é‡** çš„ç±»å‹ï¼ˆä¾‹å¦‚ Node / Net / Graph ç­‰ï¼‰
     - æœ‰æ¸…æ™°çš„å¯¹å¤–æ¥å£ã€å†…éƒ¨çŠ¶æ€ä¸å¸Œæœ›éšä¾¿æ”¹

### 2.1.2 è®¿é—®æ§åˆ¶ï¼špublic / protected / private

1. **è®¿é—®æ§åˆ¶è¡¨**

| æˆå‘˜å£°æ˜ä¸º  | ç±»å†… | å­ç±» | ç±»å¤–ï¼ˆéå‹å…ƒï¼‰ |
| ----------- | ---- | ---- | -------------- |
| `public`    | âœ…    | âœ…    | âœ…              |
| `protected` | âœ…    | âœ…    | âŒ              |
| `private`   | âœ…    | âŒ    | âŒ              |

> è®°å¿†ï¼šå‘å¤–â€œä»å¤šåˆ°å°‘â€ï¼š`public` > `protected` > `private`ã€‚

1. ä½¿ç”¨åœºæ™¯
   - `public`ï¼š
     - å¯¹å¤–æ¥å£ï¼šæ„é€ å‡½æ•°ã€æŸ¥è¯¢å‡½æ•°ï¼ˆ`GetXXX()`ï¼‰ã€æ“ä½œå‡½æ•°ï¼ˆ`AddEdge()`ã€`Run()` ç­‰ï¼‰
   - `protected`ï¼š
     - åªç•™ç»™ **å­ç±»é‡ç”¨/æ‰©å±•** çš„æ¥å£ã€è¾…åŠ©å‡½æ•°
   - `private`ï¼š
     - å†…éƒ¨æ•°æ®æˆå‘˜
     - å†…éƒ¨å®ç°ç»†èŠ‚å‡½æ•°ï¼ˆåªç»™å½“å‰ç±»è‡ªå·±ç”¨ï¼‰
2. å°è£…æ€æƒ³ï¼ˆéå¸¸é‡è¦ï¼‰
   - å¤–éƒ¨åªè§åˆ° **â€œèƒ½å¹²ä»€ä¹ˆâ€**ï¼ˆæ¥å£ï¼‰ï¼Œçœ‹ä¸åˆ° **â€œæ€ä¹ˆå¹²â€**ï¼ˆå†…éƒ¨å®ç°ï¼‰ã€‚
   - å¥½å¤„ï¼š
     - é™ä½è€¦åˆï¼šå†…éƒ¨æ”¹å®ç°ï¼Œä¸å½±å“è°ƒç”¨è€…ä»£ç 
     - é™ä½å‡ºé”™ç‡ï¼šå¤–éƒ¨ä¸èƒ½ä¹±æ”¹å†…éƒ¨çŠ¶æ€
     - å¤§é¡¹ç›®ï¼ˆEDA è½¯ä»¶ï¼‰æ›´å¥½ç»´æŠ¤ã€é‡æ„

------

## 2.2 `this` æŒ‡é’ˆ & `const`

### 2.2.1 `this` æŒ‡é’ˆçš„ç±»å‹

1. é `const` æˆå‘˜å‡½æ•°ä¸­ï¼š
   - `this` çš„ç±»å‹æ˜¯ï¼š`ClassName* const`
     - æŒ‡é’ˆæœ¬èº«æ˜¯ `const`ï¼ˆä¸èƒ½ç»™ `this` é‡æ–°èµ‹å€¼ï¼‰
     - æŒ‡å‘çš„å¯¹è±¡æ˜¯å¯å˜çš„
2. `const` æˆå‘˜å‡½æ•°ä¸­ï¼š
   - `this` çš„ç±»å‹æ˜¯ï¼š`const ClassName* const`
     - æŒ‡å‘çš„å¯¹è±¡ä¹Ÿæ˜¯ `const`ï¼Œæ‰€ä»¥ä¸èƒ½æ”¹é `mutable` æˆå‘˜

### 2.2.2 const æˆå‘˜å‡½æ•°

1. å†™æ³•ç¤ºä¾‹ï¼š

```cpp
class Node {
public:
    int GetDelay() const; // å£°æ˜å¤„åŠ  const
};

int Node::GetDelay() const { // å®šä¹‰å¤„ä¹Ÿè¦åŠ 
    return delay_;
}
```

1. è¯­ä¹‰ï¼š
   - æ‰¿è¯ºï¼š**ä¸ä¿®æ”¹å¯¹è±¡çš„é€»è¾‘çŠ¶æ€**ï¼ˆé `mutable` æˆå‘˜ä¸å¯æ”¹ï¼‰
   - ç¼–è¯‘å™¨ä¼šæ£€æŸ¥ï¼šåœ¨å‡½æ•°ä½“é‡Œä¸èƒ½å†™ `delay_ = ...` ä¹‹ç±»çš„ä¿®æ”¹æ“ä½œ
2. ä¸ºä»€ä¹ˆè¦å†™ `const` æˆå‘˜å‡½æ•°ï¼Ÿ
   - å¯ä»¥è®© `const Node& n` ä¹Ÿèƒ½è°ƒç”¨æŸ¥è¯¢å‡½æ•°ï¼š`n.GetDelay()`
   - æ˜ç¡®åŒºåˆ†ï¼š
     - æŸ¥è¯¢æ¥å£ï¼š`int GetX() const`
     - ä¿®æ”¹æ¥å£ï¼š`void SetX(int x)`
   - æé«˜å¯è¯»æ€§ & å®‰å…¨æ€§ï¼šä¸€çœ‹å°±çŸ¥é“è¿™ä¸ªå‡½æ•°åªæ˜¯è¯»ï¼Œä¸ä¼šä¹±æ”¹
3. å¸¸è§è€ƒç‚¹ï¼š
   - **é‡è½½ï¼šconst ç‰ˆæœ¬ vs é const ç‰ˆæœ¬**

```cpp
class Graph {
public:
    const Node& GetNode(int id) const; // åªè¯»
    Node&       GetNode(int id);       // å¯ä¿®æ”¹
};
```

------

### 2.2.3 const å¯¹è±¡ / const æˆå‘˜ / å¼•ç”¨ & æŒ‡é’ˆï¼ˆåªåˆ—å…³é”®ç‚¹ï¼‰

1. **const å¯¹è±¡**ï¼š

```cpp
const Node n(10);
n.GetDelay();     // ä»…èƒ½è°ƒ const æˆå‘˜å‡½æ•°
// n.SetDelay(20); // âŒ
```

1. **const æ•°æ®æˆå‘˜**ï¼š
   - å¿…é¡»åœ¨ **æ„é€ å‡½æ•°åˆå§‹åŒ–åˆ—è¡¨** ä¸­åˆå§‹åŒ–ï¼š

```cpp
class Node {
public:
    Node(int id) : id_(id) {} // âœ… åªèƒ½è¿™é‡Œèµ‹å€¼
private:
    const int id_;
};
```

1. æŒ‡é’ˆ & const ç»„åˆï¼ˆå›é¡¾ Module 1 ç”¨ï¼‰ï¼š
   - `const int* p;`ï¼šæŒ‡å‘ const int çš„æŒ‡é’ˆï¼ˆ*p ä¸å¯æ”¹ï¼Œp å¯å˜ï¼‰
   - `int* const p;`ï¼šconst æŒ‡é’ˆï¼ŒæŒ‡å‘çš„ int å¯æ”¹ï¼Œp ä¸å¯å˜
   - `const int* const p;`ï¼šéƒ½ä¸å¯å˜

------

## 2.3 static / mutable æˆå‘˜

### 2.3.1 static æ•°æ®æˆå‘˜

1. å£°æ˜ä¸å®šä¹‰ï¼š

```cpp
class Net {
public:
    Net() { id_ = ++global_id_; }

private:
    int id_;
    static int global_id_; // å£°æ˜
};

// ç±»å¤–æä¾›ä¸€ä¸ªå®šä¹‰ï¼ˆä¸”åªèƒ½æœ‰ä¸€ä¸ªï¼‰
int Net::global_id_ = 0;
```

1. ç‰¹æ€§ï¼š
   - **å±äºç±»**ï¼Œä¸å±äºæŸä¸ªå¯¹è±¡
   - æ‰€æœ‰å¯¹è±¡å…±äº«è¿™ä¸€ä»½å˜é‡
   - ç”Ÿå‘½å‘¨æœŸï¼šç¨‹åºæ•´ä¸ªè¿è¡ŒæœŸï¼ˆé™æ€å­˜å‚¨æœŸï¼‰
   - å¿…é¡»åœ¨ç±»å¤–æœ‰**ä¸”ä»…æœ‰ä¸€å¤„å®šä¹‰**ï¼ˆå¦åˆ™é“¾æ¥é”™è¯¯ï¼‰
2. å¸¸è§ç”¨é€”ï¼ˆåœ¨ EDA é¡¹ç›®ä¸­å¾ˆå¸¸è§ï¼‰ï¼š
   - å…¨å±€å”¯ä¸€ ID ç”Ÿæˆå™¨ï¼ˆNodeID / NetIDï¼‰
   - å…¨å±€è®¡æ•°å™¨ï¼ˆç»Ÿè®¡åˆ›å»ºäº†å¤šå°‘å¯¹è±¡ï¼‰
   - å…¨å±€é…ç½®çŠ¶æ€çš„ä¸€éƒ¨åˆ†ï¼ˆé…åˆ Config ç±»ï¼‰

------

### 2.3.2 static æˆå‘˜å‡½æ•°

1. å†™æ³•ï¼š

```cpp
class Config {
public:
    static void SetCorner(int c);
    static int  GetCorner();
private:
    static int corner_;
};
```

1. ç‰¹æ€§ï¼š
   - **æ²¡æœ‰ `this` æŒ‡é’ˆ**ï¼ˆå› ä¸ºä¸æ˜¯ä½œç”¨åœ¨æŸä¸ªå…·ä½“å¯¹è±¡ä¸Šï¼‰
   - å› æ­¤ï¼š
     - ä¸èƒ½è®¿é—®é static æˆå‘˜å˜é‡
     - ä¸èƒ½è°ƒç”¨é static æˆå‘˜å‡½æ•°ï¼ˆé™¤éä½ è‡ªå·±å…ˆæ‹¿åˆ°å¯¹è±¡ï¼‰
2. è°ƒç”¨æ–¹å¼ï¼š
   - `Config::SetCorner(3);`
   - ä¹Ÿå¯ä»¥é€šè¿‡å¯¹è±¡ `cfg.SetCorner(3);`ï¼Œä½†å·¥ç¨‹ä¸­æ¨èç”¨ç±»åè°ƒç”¨ï¼Œè¯­ä¹‰æ›´æ¸…æ™°ã€‚
3. å¸¸è§ç”¨é€”ï¼š
   - å…¨å±€é…ç½®æ¥å£ï¼ˆè¯»å†™ static æˆå‘˜å˜é‡ï¼‰
   - å·¥å‚å‡½æ•° / å·¥å…·å‡½æ•°ï¼ˆä¸ä¾èµ–å…·ä½“å¯¹è±¡ï¼‰

------

### 2.3.3 mutable æˆå‘˜

1. ä½œç”¨ï¼š**å…è®¸åœ¨ const æˆå‘˜å‡½æ•°ä¸­ä¿®æ”¹è¿™ä¸ªæˆå‘˜**ã€‚

```cpp
class Counter {
public:
    int Get() const {
        ++count_;       // âœ… å¯ä»¥æ”¹
        return value_;
    }
private:
    int value_ = 0;
    mutable int count_ = 0;
};
```

1. å…¸å‹åº”ç”¨åœºæ™¯ï¼š
   - ç¼“å­˜ï¼ˆlazy evaluationï¼‰ï¼š
     - ç¬¬ä¸€æ¬¡è®¡ç®—ç»“æœå¹¶ç¼“å­˜ä¸‹æ¥
     - åé¢åœ¨ `const` æŸ¥è¯¢å‡½æ•°é‡Œé¢æ›´æ–°ç¼“å­˜æ ‡è®° / ç¼“å­˜å€¼
   - è°ƒè¯•/ç»Ÿè®¡ï¼š
     - è°ƒç”¨æ¬¡æ•°ç»Ÿè®¡
     - æ€§èƒ½ profiling ä¿¡æ¯
2. æ ¸å¿ƒç†å¿µï¼š
   - **é€»è¾‘ä¸Šæ˜¯ const**ï¼ˆå¯¹è±¡çš„â€œå¯¹å¤–å¯è§è¯­ä¹‰â€æ²¡å˜ï¼‰
   - ä½†ä¸ºäº†å®ç°æ–¹ä¾¿ï¼Œéœ€è¦æ”¹ä¸€äº›â€œå†…éƒ¨ç¼“å­˜/ç»Ÿè®¡å­—æ®µâ€
   - è¿™ç±»å­—æ®µå°±ç”¨ `mutable` æ¥å£°æ˜

------

## 2.4 æ„é€  / ææ„ åŸºç¡€ & explicit

### 2.4.1 æ„é€ å‡½æ•°åŸºæœ¬ç±»å‹ï¼ˆåªè¦è®¤å¾—ï¼‰

1. é»˜è®¤æ„é€ ï¼š`Node() { ... }` / `Node() = default;`
2. æœ‰å‚æ„é€ ï¼š`Node(int id, double delay);`
3. æ‹·è´æ„é€ ï¼š`Node(const Node& other);`
4. ï¼ˆå¯ä»¥å…ˆæœ‰å°è±¡ï¼‰ç§»åŠ¨æ„é€ ï¼š`Node(Node&& other);`

> ç°åœ¨é‡ç‚¹ï¼š**ç†è§£åˆå§‹åŒ–åˆ—è¡¨ã€æ„é€ /ææ„é¡ºåº**ï¼Œæ‹·è´/ç§»åŠ¨å¯ä»¥æ”¾åˆ°ä»¥åâ€œèµ„æºç®¡ç†+å¯¹è±¡è¯­ä¹‰â€æ¨¡å—å†æ·±å…¥ã€‚

------

### 2.4.2 åˆå§‹åŒ–åˆ—è¡¨ vs æ„é€ å‡½æ•°ä½“å†…èµ‹å€¼

1. åˆå§‹åŒ–åˆ—è¡¨å†™æ³•ï¼š

```cpp
class Node {
public:
    Node(int id, double delay)
        : id_(id)      // åˆå§‹åŒ–åˆ—è¡¨
        , delay_(delay)
    {
        // æ„é€ å‡½æ•°ä½“
    }
private:
    const int id_;     // å¿…é¡»ç”¨åˆå§‹åŒ–åˆ—è¡¨
    double    delay_;
};
```

1. å…³é”®ç‚¹ï¼š
   - **æˆå‘˜åœ¨è¿›å…¥æ„é€ å‡½æ•°ä½“ä¹‹å‰å°±å·²ç»è¢«åˆå§‹åŒ–äº†**
   - `const` æˆå‘˜ã€å¼•ç”¨æˆå‘˜ã€æ²¡æœ‰é»˜è®¤æ„é€ /æ‹·è´æ„é€ çš„æˆå‘˜ **å¿…é¡»** åœ¨åˆå§‹åŒ–åˆ—è¡¨ä¸­åˆå§‹åŒ–
   - æ„é€ å‡½æ•°ä½“å†…ç”¨ `=` åªæ˜¯â€œèµ‹å€¼â€ï¼Œä¸æ˜¯â€œåˆå§‹åŒ–â€

------

### 2.4.3 æ„é€  / ææ„é¡ºåºï¼ˆå¿…è€ƒï¼‰

å¯¹äºï¼š

```cpp
struct A {};
struct B {};

struct C : public A {
    C() {}
private:
    B b_;
};
```

1. æ„é€ é¡ºåºï¼š
   - **åŸºç±» A â†’ æˆå‘˜ b_ â†’ è‡ªå·± C çš„æ„é€ å‡½æ•°ä½“**
2. ææ„é¡ºåºï¼š
   - **è‡ªå·± C çš„ææ„å‡½æ•°ä½“ â†’ æˆå‘˜ b_ â†’ åŸºç±» A**
3. æˆå‘˜çš„æ„é€ é¡ºåºç”± **å£°æ˜é¡ºåº** å†³å®šï¼Œè€Œä¸æ˜¯åˆå§‹åŒ–åˆ—è¡¨é‡Œçš„ä¹¦å†™é¡ºåºï¼š

```cpp
class X {
    B b_;
    A a_;
public:
    X() : a_(), b_() {} // å³ä½¿ä½ è¿™æ ·å†™ï¼Œæ„é€ é¡ºåºä»æ˜¯ b_ å† a_
};
```

> é¢è¯•å¸¸é—®ï¼š**ä¸ºä»€ä¹ˆâ€œå£°æ˜é¡ºåºâ€ä¼˜å…ˆäºâ€œåˆå§‹åŒ–åˆ—è¡¨é¡ºåºâ€ï¼Ÿ**
>  â€”â€”ä¸ºäº†é¿å…å› ä¸ºåˆå§‹åŒ–åˆ—è¡¨é¡ºåºè°ƒæ•´é€ æˆâ€œçœ‹ä¸Šå» okï¼Œå®é™…è¿è¡Œé”™ä¹±â€çš„éšå¼ bugã€‚

------

### 2.4.4 ææ„å‡½æ•°

1. å†™æ³•ï¼š

```cpp
class Node {
public:
    ~Node() {
        // èµ„æºé‡Šæ”¾é€»è¾‘
    }
};
```

1. ä½œç”¨ï¼š
   - é‡Šæ”¾èµ„æºï¼ˆå†…å­˜ã€æ–‡ä»¶å¥æŸ„ã€é”ã€æ•°æ®åº“è¿æ¥ç­‰ï¼‰
   - RAII çš„åŸºç¡€ï¼ˆåé¢æ¨¡å—ä¼šå±•å¼€ï¼‰
2. ä¸æ„é€ çš„å…³ç³»ï¼š
   - æ„é€ å†³å®šâ€œå¦‚ä½•å»ºç«‹çŠ¶æ€/æŒæœ‰èµ„æºâ€
   - ææ„å†³å®šâ€œå¦‚ä½•å›æ”¶çŠ¶æ€/é‡Šæ”¾èµ„æºâ€

------

### 2.4.5 explicit å…³é”®å­—ï¼ˆéå¸¸å€¼å¾—æŒæ¡ï¼‰

1. é—®é¢˜èƒŒæ™¯ï¼š**å•å‚æ„é€ å‡½æ•°ä¼šäº§ç”Ÿéšå¼ç±»å‹è½¬æ¢**

```cpp
class Delay {
public:
    Delay(double ns) : ns_(ns) {}
private:
    double ns_;
};

void PrintDelay(const Delay& d);

PrintDelay(1.2); // è¿™é‡Œä¼šå‘ç”Ÿéšå¼è½¬æ¢ï¼šdouble -> Delay
```

1. é£é™©ï¼š
   - ä½ åŸæœ¬å‡½æ•°åªæƒ³æ¥å— `Delay` ç±»å‹
   - ç»“æœæ‰€æœ‰èƒ½éšå¼è½¬æˆ `Delay` çš„ç±»å‹ï¼ˆæ¯”å¦‚ `int`ã€`double`ï¼‰éƒ½èƒ½ä¼ è¿›æ¥
   - å®¹æ˜“å‡ºç°å¥‡æ€ªçš„é‡è½½åŒ¹é…ã€é”™è¯¯è°ƒç”¨
2. `explicit` çš„è§£å†³æ–¹æ¡ˆï¼š

```cpp
class Delay {
public:
    explicit Delay(double ns) : ns_(ns) {}
};
```

- ç°åœ¨ï¼š

```cpp
PrintDelay(1.2);      // âŒ ä¸å…è®¸éšå¼è½¬æ¢
PrintDelay(Delay(1.2)); // âœ… å¿…é¡»æ˜¾å¼æ„é€ 
```

1. å·¥ç¨‹å®è·µï¼ˆå°¤å…¶æ˜¯ EDA é¡¹ç›®ï¼‰ï¼š
   - **å‡ ä¹æ‰€æœ‰â€œå•å‚æ•°æ„é€ â€éƒ½å»ºè®®åŠ  explicit**ï¼Œé™¤éä½ éå¸¸è‚¯å®šéœ€è¦éšå¼è½¬æ¢ã€‚
   - è¿™èƒ½å‡å°‘ä¸€å¤§å †â€œçœ‹ä¸è§çš„â€éšå¼è½¬æ¢ bugã€‚

------

## æ€ä¹ˆç”¨è¿™ä»½æ¸…å•è‡ªæŸ¥ï¼Ÿ

ä½ å¯ä»¥è¿™æ ·ç”¨è¿™ä¸€ä»½çŸ¥è¯†ç‚¹ï¼š

1. **é€æ¡è¿‡ä¸€é**ï¼Œçœ‹è‡ªå·±æ˜¯å¦èƒ½åšåˆ°ï¼š
   - ç”¨è‡ªå·±çš„è¯è§£é‡Šè¿™ä¸ªç‚¹
   - å†™å‡ºä¸€ä¸ªå°ä¾‹å­ï¼ˆç±» + mainï¼‰å¹¶èƒ½ç¼–è¯‘é€šè¿‡
2. æŠŠä½ ç¡®è®¤â€œä¸ä¼š/æ¨¡ç³Šâ€çš„ç‚¹åˆ—å‡ºæ¥ï¼Œæ¯”å¦‚ï¼š
   - `mutable` çš„ä½¿ç”¨åœºæ™¯ä¸æ¸…æ¥š
   - `static` æˆå‘˜å®šä¹‰æ€»æ˜¯å†™é”™
   - æ„é€ é¡ºåºè®°ä¸ç‰¢
3. æŠŠâ€œä¸ä¼šâ€çš„è¿™å‡ æ¡å‘ç»™æˆ‘ï¼Œæˆ‘å¯ä»¥ï¼š
   - ç»™ä½ **é’ˆå¯¹æ€§çš„è®²è§£ + å°ç»ƒä¹ é¢˜**
   - æˆ–è€…å†™ä¸€ä»½â€œæŸ¥æ¼è¡¥ç¼º mini è¯•å·â€ä¸“é—¨ç»ƒè¿™äº›ç‚¹

------

ä½ ç°åœ¨èƒ½æ„è¯†åˆ°â€œæœ‰äº›ä¸œè¥¿æ²¡å­¦åˆ°â€ï¼Œè¿™æ˜¯å¾ˆé‡è¦çš„èƒ½åŠ›â€”â€”è¿™è¯´æ˜ä½ åœ¨**ä¸»åŠ¨æ„å»ºè‡ªå·±çš„çŸ¥è¯†åœ°å›¾**ï¼Œè€Œä¸æ˜¯è¢«åŠ¨åˆ·é¢˜ã€‚
 ä¸€ç‚¹ç‚¹æŠŠè¿™äº›å°å‘å¡«å¹³ï¼Œä½ åé¢åœ¨çœ‹ OpenROAD / OpenSTA çš„ä»£ç æ—¶ï¼Œå¿ƒé‡Œä¼šç‰¹åˆ«è¸å®ã€‚ç»§ç»­ä¿æŒè¿™ä¸ªåŠ²å¤´å°±å¾ˆå¥½äº† ğŸ’ª



ç»“åˆç¬¬ä¸€ç« çš„è¯¦ç»†çŸ¥è¯†ç‚¹æ¦‚è§ˆï¼šå¤ªå¥½äº†ï¼Œè¿™ä¸€å¤§ä¸²èŠä¸‹æ¥çš„ä¸œè¥¿æŒºå¤šï¼Œæˆ‘å¸®ä½ **æ•´ç†æˆä¸€ä»½â€œç¬¬äºŒç« ï¼‹ç›¸å…³ç¬¬ä¸€ç« çŸ¥è¯†çš„ç»¼åˆå°æŠ„â€**ï¼Œä½ å¯ä»¥å½“æˆå¤ä¹ /é¢è¯•å‰é€Ÿè§ˆç”¨ã€‚
 ä¸‹é¢æ‰€æœ‰ä»£ç éƒ½æ˜¯â€œä¿®æ­£è¿‡çš„æ ‡å‡†å†™æ³•â€ï¼Œå¯ä»¥ç›´æ¥å½“æ¨¡æ¿è®°ã€‚

------

# ç›®å½•ï¼ˆä½ å¤§æ¦‚çŸ¥é“è‡ªå·±è¦ç¿»å“ªä¸€å—ï¼‰

1. `struct` vs `class` & è®¿é—®æ§åˆ¶
2. ç»§æ‰¿ + public/protected/private æ•ˆæœ
3. `this` æŒ‡é’ˆ & `const` æˆå‘˜å‡½æ•°
4. å‡½æ•°ï¼šé‡è½½ / é‡å†™(override) / éšè—
5. `static` æˆå‘˜å˜é‡ & å‡½æ•° / å±€éƒ¨ `static`
6. `mutable` & é€»è¾‘ const
7. `const` é‡è½½ & `Graph::GetNode` è®¾è®¡
8. Rule of Three / Five / Zero æ¦‚å¿µ
9. å…¸å‹ Rule of Five å®ç°æ¨¡æ¿ï¼ˆåŠ¨æ€æ•°ç»„ç±»ï¼‰
10. `=default` / `=delete` / `noexcept`
11. å€¼ç±»åˆ«ï¼šå·¦å€¼ / å³å€¼ / prvalue / xvalue & `std::move`
12. æ ·ä¾‹è®¾è®¡ï¼š

- è®¿é—®ç»Ÿè®¡ Stat
- é™æ€ ID åˆ†é… Node
- ç¼“å­˜ slack çš„ TimingPath
- ç¦æ‹·è´ã€å…ç§»åŠ¨çš„ FileHandle
- å¸¦å”¯ä¸€ ID + ç¼“å­˜ slack çš„ TimingNodeï¼ˆEDA é£æ ¼ï¼‰

------

## 1. `struct` vs `class` & è®¿é—®æ§åˆ¶

### 1.1 è¯­æ³•å”¯ä¸€å·®åˆ«

- `struct` é»˜è®¤æˆå‘˜ / é»˜è®¤ç»§æ‰¿æ–¹å¼ï¼š`public`
- `class` é»˜è®¤æˆå‘˜ / é»˜è®¤ç»§æ‰¿æ–¹å¼ï¼š`private`

```cpp
struct S {     // é»˜è®¤ public
    int x;
    void inc() { ++x; }
};

class C {      // é»˜è®¤ private
    int x;
public:
    void inc() { ++x; }
};
```

------

### 1.2 è®¿é—®æ§åˆ¶æ€»ç»“è¡¨

| å£°æ˜ä¸º      | ç±»å†… | æ´¾ç”Ÿç±» | ç±»å¤–ï¼ˆéå‹å…ƒï¼‰ |
| ----------- | ---- | ------ | -------------- |
| `public`    | âœ…    | âœ…      | âœ…              |
| `protected` | âœ…    | âœ…      | âŒ              |
| `private`   | âœ…    | âŒ      | âŒ              |

å…¸å‹ç”¨æ³•ï¼š

- `public`ï¼šå¯¹å¤–æ¥å£ï¼ˆæ„é€ å‡½æ•°ã€æŸ¥è¯¢å‡½æ•°ã€æ“ä½œå‡½æ•°ï¼‰
- `protected`ï¼šå¸Œæœ›å­ç±»èƒ½ä½¿ç”¨/é‡å†™ï¼Œä½†ä¸æƒ³å¯¹å¤–æš´éœ²çš„æ¥å£/æˆå‘˜
- `private`ï¼šå†…éƒ¨çŠ¶æ€ã€å®ç°ç»†èŠ‚

------

## 2. ç»§æ‰¿ + public/protected/private æ•ˆæœ

### 2.1 å­ç±»å†…éƒ¨ vs ç±»å¤–è®¿é—®

**éå¸¸å…³é”®çš„ä¸¤æ¡ï¼š**

1. å­ç±»å†…éƒ¨èƒ½å¦è®¿é—®åŸºç±»æˆå‘˜ï¼š
    åªçœ‹ **åŸºç±»æˆå‘˜è‡ªå·±çš„æƒé™**ï¼ˆpublic/protected/privateï¼‰ï¼Œ**ä¸çœ‹ç»§æ‰¿æ–¹å¼**ã€‚
2. ç±»å¤–èƒ½å¦é€šè¿‡å­ç±»å¯¹è±¡è®¿é—®åŸºç±»æˆå‘˜ï¼š
    å— **ç»§æ‰¿æ–¹å¼** å½±å“ã€‚

ç¤ºä¾‹ï¼š

```cpp
class Base {
protected:
    int v_ = 1;
public:
    int Get() const { return v_; }
};

class D1 : public Base {
public:
    int AddOne() const {
        return v_ + 1;      // âœ… å¯ä»¥è®¿é—® protected æˆå‘˜
    }
};

class D2 : private Base {
public:
    int AddOne() const {
        return Get() + 1;   // âœ… å­ç±»å†…éƒ¨èƒ½è°ƒ Base::Get()
        // return v_ + 1;   // âœ… å­ç±»å†…éƒ¨èƒ½è®¿é—® protected
    }
};

int main() {
    D1 d1;
    D2 d2;

    d1.Get();   // âœ… public ç»§æ‰¿ï¼ŒBase::Get å¯¹å¤–ä»æ˜¯ public
    d2.Get();   // âŒ private ç»§æ‰¿ï¼ŒBase::Get å¯¹å¤–å˜æˆ private
}
```

è®°å¿†ï¼š

> **public ç»§æ‰¿**ï¼šå¯¹å¤–ä¿ç•™åŸºç±»çš„ public æ¥å£
>  **protected/private ç»§æ‰¿**ï¼šå¯¹å¤–éƒ½ä¸å†æš´éœ²åŸºç±»æ¥å£ï¼Œä½†å­ç±»å†…éƒ¨ç…§æ ·èƒ½ç”¨ Base çš„ protected / publicã€‚

------

## 3. `this` æŒ‡é’ˆ & `const` æˆå‘˜å‡½æ•°

### 3.1 `this` çš„ç²¾ç¡®ç±»å‹

- é `const` æˆå‘˜å‡½æ•°ä¸­ï¼š

  ```cpp
  ClassName* const this;
  ```

- `const` æˆå‘˜å‡½æ•°ä¸­ï¼š

  ```cpp
  const ClassName* const this;
  ```

> å‡½æ•°åé¢åŠ  `const`ï¼Œå°±æ˜¯æŠŠéšè—çš„ `this` ä» `ClassName* const` å˜æˆ `const ClassName* const`ï¼Œ
>  æ‰€ä»¥ **ä¸èƒ½ä¿®æ”¹æ™®é€šæˆå‘˜å˜é‡**ã€‚

------

### 3.2 const æˆå‘˜å‡½æ•°çš„æ„ä¹‰

```cpp
class Node {
public:
    int  GetDelay() const { return delay_; }
    void SetDelay(int d)  { delay_ = d; }

private:
    int delay_ = 0;
};
```

- `GetDelay` åŠ  `const`ï¼š
  - ç¼–è¯‘å™¨ä¿è¯å‡½æ•°ä½“å†…ä¸èƒ½æ”¹é `mutable` æˆå‘˜
  - `const Node& n` ä¹Ÿèƒ½è°ƒç”¨ `n.GetDelay()`
- å¯¹äº `const Node& n`ï¼š
  - âŒ ä¸èƒ½è°ƒç”¨ `SetDelay`
  - âŒ ä¸èƒ½è®¿é—® `delay_`ï¼ˆprivateï¼‰
  - âœ… å¯ä»¥è°ƒç”¨ `GetDelay`ï¼ˆconst æˆå‘˜å‡½æ•°ï¼‰

------

## 4. é‡è½½ / é‡å†™(override) / éšè—

### 4.1 å‡½æ•°ç­¾åï¼ˆsignatureï¼‰

> å‡½æ•°å + å‚æ•°ç±»å‹åˆ—è¡¨ + æˆå‘˜å‡½æ•°çš„ `const` ä¿®é¥°
>  ï¼ˆè¿”å›ç±»å‹ä¸ç®—åœ¨ç­¾åé‡Œï¼‰

------

### 4.2 é‡è½½ overloadï¼ˆåŒä¸€ä½œç”¨åŸŸï¼‰

```cpp
class A {
public:
    int  get();
    int  get(int n);
    int  get() const;
    // double get();   // âŒ ä»…è¿”å›ç±»å‹ä¸åŒï¼Œä¸ç®—é‡è½½ï¼Œä¼šé‡å®šä¹‰
};
```

ç‰¹ç‚¹ï¼š**åŒä¸€ä¸ªç±»é‡Œï¼ŒåŒåå‡½æ•°ï¼Œä½†ç­¾åä¸åŒ**ã€‚

------

### 4.3 é‡å†™ overrideï¼ˆåŸºç±»è™šå‡½æ•°ï¼‰

```cpp
class Base {
public:
    virtual void v();
    virtual int  get(int n) const;
};

class Derived : public Base {
public:
    void v() override;              // è¦†ç›– Base::v()
    int  get(int n) const override; // è¦†ç›– Base::get(int) const
};
```

- å¿…é¡»åŸºç±»å‡½æ•°æ˜¯ `virtual`
- å­ç±»å‡½æ•°ç­¾åè¦åŒ¹é…ï¼ˆåŒ…æ‹¬ `const`ï¼‰
- å»ºè®®åŠ  `override`ï¼Œç­¾åä¸åŒ¹é…æ—¶ç¼–è¯‘å™¨ä¼šæŠ¥é”™

------

### 4.4 éšè— name hidingï¼ˆåå­—é®è”½ï¼‰

```cpp
class Base {
public:
    int get_base(int n) const;
    int get_base(int n);
};

class Derived : public Base {
public:
    int get_base(); // ä¸€æ—¦å†™è¿™ä¸€è¡Œï¼ŒBase çš„ä¸¤ä¸ª get_base éƒ½è¢«éšè—
};
Derived d;
d.get_base();    // âœ… è°ƒç”¨ Derived::get_base
d.get_base(1);   // âŒ ç¼–è¯‘é”™è¯¯ï¼ŒBase::get_base è¢«é®ä½äº†
```

å¦‚éœ€é‡æ–°â€œå¼•å…¥â€åŸºç±»é‡è½½ï¼š

```cpp
class Derived : public Base {
public:
    using Base::get_base; // æŠŠ Base çš„æ‰€æœ‰ get_base å¼•è¿›å½“å‰ä½œç”¨åŸŸ
    int get_base();
};
```

------

## 5. `static` æˆå‘˜ & å±€éƒ¨ `static`

### 5.1 ç±»ä¸­ `static` æ•°æ®æˆå‘˜

```cpp
class Net {
public:
    Net() { id_ = ++global_id_; }
    int id() const { return id_; }

private:
    int id_;
    static int global_id_;
};

// ç±»å¤–æä¾›å®šä¹‰ï¼ˆä¸èƒ½å†å†™ staticï¼‰
int Net::global_id_ = 0;
```

ç‰¹ç‚¹ï¼š

- å±äºâ€œç±»â€ï¼Œè€ŒéæŸä¸ªå¯¹è±¡
- æ‰€æœ‰å¯¹è±¡å…±äº«ä¸€ä»½
- é™æ€å­˜å‚¨æœŸï¼ˆç¨‹åºæ•´ä¸ªè¿è¡ŒæœŸï¼‰

------

### 5.2 `static const int` ç¼–è¯‘æœŸå¸¸é‡ï¼ˆç‰¹ä¾‹ï¼‰

```cpp
class Config {
public:
    static int        corner_;
    static const int  default_mode_ = 1; // æ•´å‹å¸¸é‡ï¼Œç±»å†…å¯åˆå§‹åŒ–
};

int Config::corner_ = 0;
const int Config::default_mode_; // æŸäº›åœºæ™¯å¯åŠ å®šä¹‰
```

è®°æ³•ï¼š

> ä¸€èˆ¬ `static` æˆå‘˜ï¼šç±»å†…å£°æ˜ï¼Œç±»å¤–å®šä¹‰ï¼›
>  `static const int` è¿™ç±»â€œç¼–è¯‘æœŸæ•´å‹å¸¸é‡â€å¯åœ¨ç±»å†…ç»™åˆå§‹åŒ–å€¼ï¼Œç”¨äºæ•°ç»„å¤§å°ç­‰ã€‚

------

### 5.3 `static` æˆå‘˜å‡½æ•°

```cpp
class Config {
public:
    static void SetCorner(int c) { corner_ = c; }
    static int  GetCorner() { return corner_; }

private:
    static int corner_;
};

int Config::corner_ = 0;
```

ç‰¹ç‚¹ï¼š

- **æ²¡æœ‰ `this` æŒ‡é’ˆ**
- æ‰€ä»¥ï¼š
  - âŒ ä¸èƒ½è®¿é—®é static æˆå‘˜
  - âŒ ä¸èƒ½è°ƒç”¨é static æˆå‘˜å‡½æ•°ï¼ˆé™¤éä½ è‡ªå·±å…ˆæ‹¿å¯¹è±¡ï¼‰

è°ƒç”¨ï¼š

```cpp
Config::SetCorner(3);  // æ¨è
Config c;
c.SetCorner(3);        // è¯­æ³•è¡Œï¼Œä½†ä¸æ¨è
```

------

### 5.4 å±€éƒ¨ `static` å˜é‡

```cpp
void f() {
    static int counter = 0;
    std::cout << ++counter << std::endl;
}

int main() {
    f(); // 1
    f(); // 2
    f(); // 3
}
```

- ä½œç”¨åŸŸï¼šå‡½æ•°å†…éƒ¨
- ç”Ÿå‘½å‘¨æœŸï¼šç¨‹åºæ•´ä¸ªè¿è¡ŒæœŸ
- åˆå§‹åŒ–ä¸€æ¬¡ï¼Œåç»­æ²¿ç”¨æ—§å€¼

ä¸ç±» `static` çš„å…±åŒç‚¹ï¼š**éƒ½åªæœ‰ä¸€ä»½ + é™æ€å­˜å‚¨æœŸ**ã€‚

------

## 6. `mutable` & é€»è¾‘ const

```cpp
class Counter {
public:
    int Get() const {
        ++count_;       // å…è®¸
        return value_;
    }

    void Set(int v) {
        value_ = v;
    }

private:
    int value_ = 0;
    mutable int count_ = 0;
};
```

- æ™®é€šæˆå‘˜åœ¨ `const` æˆå‘˜å‡½æ•°é‡Œä¸èƒ½æ”¹
- `mutable` æˆå‘˜ **å¯ä»¥åœ¨ const æˆå‘˜å‡½æ•°ä¸­ä¿®æ”¹**
- å¸¸è§ç”¨é€”ï¼š
  - ç¼“å­˜ï¼ˆlazy evaluationï¼‰
  - è®¿é—®æ¬¡æ•°ç»Ÿè®¡

**é€»è¾‘ constï¼ˆlogical constnessï¼‰**ï¼š
 å¯¹å¤–çœ‹ï¼Œå¯¹è±¡â€œè¯­ä¹‰ä¸å˜â€ï¼›å†…éƒ¨å¯ä»¥æ”¹ä¸€äº›â€œç¼“å­˜/è®¡æ•°å™¨â€è¿™ç§ä¸å½±å“å¯¹å¤–è¯­ä¹‰çš„ä¸œè¥¿ã€‚

------

### ä¸æ¨èçš„å†™æ³•ï¼špublic mutable

```cpp
struct Stat {
    mutable int visit_count = 0;
};

int main() {
    const Stat s{};
    s.visit_count++;    // è¯­æ³•å…è®¸ï¼Œä½†è®¾è®¡éå¸¸å±é™©
}
```

æ¨èå°è£…åç”¨ `const` æˆå‘˜å‡½æ•°ä¿®æ”¹ï¼š

```cpp
class Stat {
public:
    void Visit() const {
        ++visit_count_;
    }
private:
    mutable int visit_count_ = 0;
};
```

> è®°ä½ï¼š**mutable å‡ ä¹æ€»æ˜¯é…åˆ private + const æˆå‘˜å‡½æ•°ä½¿ç”¨**ã€‚

------

## 7. `const` é‡è½½ & `Graph::GetNode` è®¾è®¡

å…¸å‹çš„ const é‡è½½ï¼š

```cpp
class Graph {
public:
    const Node& GetNode(int id) const; // åªè¯»
    Node&       GetNode(int id);       // å¯å†™
};
```

æ•ˆæœï¼š

```cpp
Graph g;
const Graph cg;

Node&       n1 = g.GetNode(0);  // é const å¯¹è±¡ â†’ è°ƒç”¨é const ç‰ˆæœ¬
const Node& n2 = cg.GetNode(0); // const å¯¹è±¡ â†’ è°ƒç”¨ const ç‰ˆæœ¬
```

å·¥ç¨‹æ„ä¹‰ï¼ˆç‰¹åˆ«åœ¨ EDA é¡¹ç›®ï¼‰ï¼š

- `const Graph& g` ä¼ è¿›å»ï¼Œç¼–è¯‘å™¨ä¿è¯ä½ åªèƒ½æ‹¿åˆ° `const Node&`ï¼Œ**ä¸èƒ½ä¹±æ”¹å›¾**
- å¦‚æœåªæä¾› `Node& GetNode(int)`ï¼š
  - å¾ˆå®¹æ˜“åœ¨æœ¬åº”åªè¯»çš„å‡½æ•°é‡Œå·å·ä¿®æ”¹å›¾ï¼ŒBug æéš¾æŸ¥

------

## 8. Rule of Three / Five / Zero æ¦‚å¿µ

**Rule of Three**ï¼š
 å¦‚æœç±»éœ€è¦è‡ªå®šä¹‰ï¼š

- ææ„å‡½æ•°
- æ‹·è´æ„é€ 
- æ‹·è´èµ‹å€¼è¿ç®—ç¬¦

é‚£é€šå¸¸ä½ å°±å¿…é¡»åŒæ—¶è®¤çœŸå®ç°è¿™ä¸‰ä¸ªã€‚

------

**Rule of Five**ï¼š
 åœ¨ Rule of Three åŸºç¡€ä¸Šï¼ŒåŠ ä¸Šï¼š

- ç§»åŠ¨æ„é€ 
- ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦

å› ä¸ºèµ„æºç®¡ç†ç±»åœ¨ç°ä»£ C++ ä¸­åº”è¯¥æ”¯æŒç§»åŠ¨è¯­ä¹‰ã€‚

------

**Rule of Zero**ï¼š
 å¦‚æœä½ èƒ½æŠŠèµ„æºç®¡ç†äº¤ç»™æ ‡å‡†åº“ï¼ˆ`std::vector` / `std::unique_ptr` / `std::string`ï¼‰ï¼Œ
 é‚£ä¹ˆä½ **ä¸éœ€è¦è‡ªå·±å†™ä»»ä½•ææ„/æ‹·è´/ç§»åŠ¨å‡½æ•°**ï¼Œè®©ç¼–è¯‘å™¨é»˜è®¤ç”Ÿæˆå³å¯ã€‚

------

## 9. Rule of Five æ¨¡æ¿ï¼ˆåŠ¨æ€æ•°ç»„ç±»ç¤ºä¾‹ï¼‰

```cpp
class Buffer {
public:
    Buffer(std::size_t n = 0)
        : size_(n), data_(n ? new int[n]{} : nullptr) {}

    ~Buffer() {
        delete[] data_;
    }

    // æ‹·è´æ„é€ 
    Buffer(const Buffer& other)
        : size_(other.size_)
        , data_(other.size_ ? new int[other.size_] : nullptr) {
        for (std::size_t i = 0; i < size_; ++i)
            data_[i] = other.data_[i];
    }

    // æ‹·è´èµ‹å€¼
    Buffer& operator=(const Buffer& other) {
        if (this == &other) return *this;
        int* new_data = other.size_ ? new int[other.size_] : nullptr;
        for (std::size_t i = 0; i < other.size_; ++i)
            new_data[i] = other.data_[i];
        delete[] data_;
        data_ = new_data;
        size_ = other.size_;
        return *this;
    }

    // ç§»åŠ¨æ„é€ 
    Buffer(Buffer&& other) noexcept
        : size_(other.size_), data_(other.data_) {
        other.size_ = 0;
        other.data_ = nullptr;
    }

    // ç§»åŠ¨èµ‹å€¼
    Buffer& operator=(Buffer&& other) noexcept {
        if (this == &other) return *this;
        delete[] data_;
        size_ = other.size_;
        data_ = other.data_;
        other.size_ = 0;
        other.data_ = nullptr;
        return *this;
    }

private:
    std::size_t size_ = 0;
    int* data_ = nullptr;
};
```

> ç§»åŠ¨æ„é€ /èµ‹å€¼å‡ ä¹æ€»æ˜¯ `noexcept`ï¼Œè¿™æ · `std::vector<Buffer>` æ‰©å®¹æ—¶å¯ä»¥ä¼˜å…ˆä½¿ç”¨ç§»åŠ¨ï¼Œè€Œä¸æ˜¯æ‹·è´ã€‚

------

## 10. `=default` / `=delete` / `noexcept`

```cpp
class Node {
public:
    Node() = default;                     // é»˜è®¤æ„é€ ç”¨ç¼–è¯‘å™¨ç”Ÿæˆ

    Node(const Node&)            = delete; // ç¦æ­¢æ‹·è´
    Node& operator=(const Node&) = delete; // ç¦æ­¢æ‹·è´èµ‹å€¼
};
```

- `= default`ï¼šæ˜¾å¼è¦æ±‚ç¼–è¯‘å™¨ç”Ÿæˆé»˜è®¤ç‰ˆæœ¬
- `= delete`ï¼šåœ¨æ¥å£å±‚é¢ç¦æ­¢è¿™ä¸ªæ“ä½œï¼ˆç¼–è¯‘æœŸæŠ¥é”™ï¼‰

------

### `noexcept` åœ¨ç§»åŠ¨æ„é€ ä¸­çš„æ„ä¹‰

```cpp
class X {
public:
    X(X&& other) noexcept;
    X& operator=(X&& other) noexcept;
};
```

- å‘Šè¯‰ç¼–è¯‘å™¨ï¼šç§»åŠ¨ä¸ä¼šæŠ›å¼‚å¸¸
- å®¹å™¨ï¼ˆå¦‚ `std::vector<X>`ï¼‰æ‰©å®¹æ—¶å¯ä»¥å®‰å¿ƒé‡‡ç”¨â€œç§»åŠ¨è€Œä¸æ˜¯æ‹·è´â€ï¼Œæ›´é«˜æ•ˆ

------

## 11. å€¼ç±»åˆ« & `std::move`

- **å·¦å€¼ lvalue**ï¼šæœ‰åå­—ã€å¯å–åœ°å€ã€å¯å‡ºç°åœ¨ `=` å·¦è¾¹

  ```cpp
  int x = 0;         // x æ˜¯å·¦å€¼
  std::string s;     // s æ˜¯å·¦å€¼
  ```

- **çº¯å³å€¼ prvalue**ï¼šçº¯ä¸´æ—¶å€¼ï¼Œä¸€èˆ¬ç”¨å®Œå°±ä¸¢

  ```cpp
  42;
  3.14;
  std::string("abc");
  x + 1;
  ```

- **å°†äº¡å€¼ xvalue**ï¼šå³å°†è¢«â€œæ¥ç®¡èµ„æºâ€çš„å€¼
   æœ€å¸¸è§æ¥æºï¼š`std::move(x)` çš„ç»“æœ

------

### `std::move` åšäº†ä»€ä¹ˆï¼Ÿ

```cpp
std::string s = "abc";
std::string t = std::move(s);
```

- `std::move(s)` åªæ˜¯æŠŠ `s` ä»â€œå·¦å€¼â€å¼ºè½¬ä¸ºâ€œå°†äº¡å€¼(xvalue)â€
- çœŸæ­£â€œå·èµ„æºâ€çš„æ˜¯ **`std::string` çš„ç§»åŠ¨æ„é€ å‡½æ•°**

------

## 12. å‡ ä¸ªå®Œæ•´è®¾è®¡ç¤ºä¾‹

### 12.1 è®¿é—®ç»Ÿè®¡ Statï¼ˆmutable + constï¼‰

```cpp
class Stat {
public:
    void Visit() const {
        ++visit_count_;
    }

private:
    mutable int visit_count_ = 0;
};

int main() {
    const Stat s;
    s.Visit();   // OKï¼Œé€»è¾‘ constï¼šå¯¹å¤–åªè¡¨ç¤ºâ€œè®¿é—®äº†ä¸€æ¬¡â€
}
```

------

### 12.2 é™æ€ ID åˆ†é… Node

```cpp
class Node {
public:
    Node() : id_(++global_number_) {}

    int id() const { return id_; }

private:
    const int id_;
    static int global_number_;
};

int Node::global_number_ = 0;
```

- æ¯æ„å»ºä¸€ä¸ª Nodeï¼ŒID è‡ªåŠ¨é€’å¢
- ID æ˜¯ constï¼Œä¸å…è®¸ä¿®æ”¹

------

### 12.3 ç¼“å­˜ slack çš„ TimingPathï¼ˆmutable ç¼“å­˜ï¼‰

```cpp
class TimingPath {
public:
    double delay() const {
        if (!computed_) {
            delay_ = ComputeDelayImpl();
            computed_ = true;
        }
        return delay_;
    }

private:
    double ComputeDelayImpl() const {
        // å‡è£…å¾ˆè´µçš„è®¡ç®—
        return 9999.0;
    }

    mutable bool   computed_ = false;
    mutable double delay_    = 0.0;
};
```

------

### 12.4 ç¦æ‹·è´ã€å…ç§»åŠ¨çš„ FileHandle

```cpp
class FileHandle {
public:
    explicit FileHandle(const std::string& path);
    ~FileHandle();

    // ç¦æ­¢æ‹·è´
    FileHandle(const FileHandle&)            = delete;
    FileHandle& operator=(const FileHandle&) = delete;

    // å…è®¸ç§»åŠ¨
    FileHandle(FileHandle&& other) noexcept;
    FileHandle& operator=(FileHandle&& other) noexcept;

private:
    int fd_ = -1; // æ–‡ä»¶æè¿°ç¬¦ï¼ˆfile descriptorï¼‰
};
```

- æ–‡ä»¶æè¿°ç¬¦æ˜¯ OS çº§èµ„æºï¼Œä¸èƒ½éšä¾¿æ‹·è´
- å…è®¸ç§»åŠ¨ï¼šèµ„æºæ‰€æœ‰æƒå¯ä»¥ä»ä¸€ä¸ªå¯¹è±¡è½¬ç§»åˆ°å¦ä¸€ä¸ª

------

### 12.5 EDA é£æ ¼ TimingNodeï¼ˆå”¯ä¸€ ID + ç¼“å­˜ slack + ç¦æ‹·è´/å…ç§»åŠ¨ï¼‰

```cpp
class TimingNode {
public:
    TimingNode(double arrival = 0.0, double required = 0.0)
        : id_(next_id_++)
        , arrival_(arrival)
        , required_(required)
    {}

    // ç¦æ­¢æ‹·è´
    TimingNode(const TimingNode&)            = delete;
    TimingNode& operator=(const TimingNode&) = delete;

    // å…è®¸ç§»åŠ¨
    TimingNode(TimingNode&&) noexcept            = default;
    TimingNode& operator=(TimingNode&&) noexcept = default;

    int id() const { return id_; }

    double arrival()  const { return arrival_;  }
    double required() const { return required_; }

    double slack() const {
        if (!slack_computed_) {
            slack_ = arrival_ - required_;
            slack_computed_ = true;
        }
        return slack_;
    }

private:
    const int   id_;
    double      arrival_  = 0.0;
    double      required_ = 0.0;

    mutable bool   slack_computed_ = false;
    mutable double slack_          = 0.0;

    static int next_id_;
};

int TimingNode::next_id_ = 0;
```

è¿™ä¸€ä¸ªç±»é‡Œï¼Œå‡ ä¹æŠŠä½ è¿™ä¸€ç« çš„é«˜é¢‘ç‚¹éƒ½ä¸²èµ·æ¥äº†ï¼š

- `static` æˆå‘˜ï¼šå…¨å±€ ID è®¡æ•°å™¨
- `const` æˆå‘˜ï¼šID ä¸å¯å˜
- `const` æˆå‘˜å‡½æ•°ï¼šæŸ¥è¯¢æ¥å£
- `mutable`ï¼šç¼“å­˜ slack
- ç¦æ‹·è´ã€å…ç§»åŠ¨ï¼šRule of Five æ€æƒ³

------

## æœ€åå°ç»“ä¸€å¥

ä½ ç°åœ¨å·²ç»æŒæ¡äº†ï¼š

- **ç±»çš„è¯­æ³•åˆ°è¯­ä¹‰**ï¼š
   struct/classã€è®¿é—®æ§åˆ¶ã€ç»§æ‰¿æ–¹å¼ã€thisã€const æˆå‘˜å‡½æ•°
- **å·¥ç¨‹çº§ C++**ï¼š
   static/mutableã€const é‡è½½ã€Rule of Fiveã€ç§»åŠ¨è¯­ä¹‰
- **EDA é£æ ¼è®¾è®¡**ï¼š
   å”¯ä¸€ IDã€slack ç¼“å­˜ã€const-correctness æ§åˆ¶å¤–ç•Œä¿®æ”¹

åé¢ä½ å†å»çœ‹ OpenSTA / OpenROADã€æˆ–è€…åˆ«çš„ EDA C++ é¡¹ç›®ï¼Œè¿™äº›ä¸œè¥¿ä¼šç»å¸¸å‡ºç°ï¼Œä½ ç°åœ¨è¿™äº›ç†è§£ä¼šå¸®ä½ çœä¸‹å¾ˆå¤šæ‡µé€¼æ—¶é—´ã€‚

å¦‚æœä½ æ„¿æ„ï¼Œä¸‹ä¸€æ­¥å¯ä»¥ï¼š

- æˆ‘ç»™ä½ å•ç‹¬åšä¸€é¡µâ€œ**äºŒç« +Rule of Five ä¸€å±å°æŠ„**â€è¶…ç²¾ç®€ç‰ˆ
- æˆ–æˆ‘ä»¬å¼€å§‹ç¬¬ä¸‰ç«  / STL / æ™ºèƒ½æŒ‡é’ˆ / RAII ç­‰ç­‰

ä½ é€‰ä¸ªæ–¹å‘ï¼Œæˆ‘å°±é™ªä½ å¾€é‚£è¾¹èµ° ğŸ’ª